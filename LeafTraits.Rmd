---
title: "LeafTraits"
author: "Marcela Morassi"
date: "8/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Marcela's startup (wd, data, packages)
```{r}
library(tidyverse)

data <- read_csv("LeafTraitsTW0.csv")

data_clean <- data %>% 
  filter(percent_damage>0)


```

Amy's startup
```{r}
library(tidyverse)
library(ggpubr)
library(RColorBrewer)
library(rcompanion)

setwd("C:/Users/hrusk/Dropbox (Smithsonian)/2021_SummerInterns/MM")

data <- read.csv("LeafTraitsTW0.csv")


```

Data manipulation
```{r}

##filter for samples with percent damage##
percent_damage <- data %>% 
  filter(percent_damage>0)

```


BarStats Function 
```{r}
#barGraphStats(data=, variable="", byFactorNames=c(""))
barGraphStats <- function(data, variable, byFactorNames) {
  count <- length(byFactorNames)
  N <- aggregate(data[[variable]], data[byFactorNames], FUN=length)
  names(N)[1:count] <- byFactorNames
  names(N) <- sub("^x$", "N", names(N))
  mean <- aggregate(data[[variable]], data[byFactorNames], FUN=mean)
  names(mean)[1:count] <- byFactorNames
  names(mean) <- sub("^x$", "mean", names(mean))
  sd <- aggregate(data[[variable]], data[byFactorNames], FUN=sd)
  names(sd)[1:count] <- byFactorNames
  names(sd) <- sub("^x$", "sd", names(sd))
  preSummaryStats <- merge(N, mean, by=byFactorNames)
  finalSummaryStats <- merge(preSummaryStats, sd, by=byFactorNames)
  finalSummaryStats$se <- finalSummaryStats$sd / sqrt(finalSummaryStats$N)
  return(finalSummaryStats)
}

```


Damage by species
```{r}
##Creating colourblind palette###
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

##saved graph as variable to edit theme below##
g1 <- ggplot(data = barGraphStats(data = percent_damage, variable = "percent_damage", byFactorNames = c("species")), aes(x=species, y=mean, fill = species)) +
    geom_bar(stat='identity', position=position_dodge()) +
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width = 0.2, position = position_dodge(0.9)) +
    xlab("Species") + ylab("Percent Damage") +
    scale_fill_manual(values = cbPalette) 

##setting theme to remove background grid and add axis lines##    
g1 + theme(panel.background = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 16),axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)), axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)), legend.position = "none")

```

Boxplot percent damage by species
```{r}
ggplot(percent_damage, aes(x=species, y=percent_damage)) + geom_boxplot()

```

